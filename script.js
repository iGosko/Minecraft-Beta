!function(){var e=document.getElementById("cursor");e.style.left=(.5*window.innerWidth-.5*e.width).toString()+"px",e.style.top=(.5*window.innerHeight-.5*e.height).toString()+"px";var t=new Stats;t.showPanel(0),document.body.appendChild(t.dom),requestAnimationFrame(function e(){t.begin(),t.end(),requestAnimationFrame(e)}),noise.seed(Math.random());var n=new THREE.Scene;n.background=new THREE.Color(0);var a=new THREE.WebGLRenderer;a.setSize(window.innerWidth,window.innerHeight),document.body.appendChild(a.domElement);var o=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,1e3);function r(e,t,n,a,o){this.x=e,this.y=t,this.z=n,this.placed=a,this.blockType=o}var i=[],s=0,h=0,l=.05,d=30+70*Math.random();let c=prompt("render distance: ");if(parseInt(c))var p=parseInt(c);else{alert("invalid value! setting to default render distance of 2.");p=2}var f=16,u=5,y=-250;o.position.x=p*f/2*5,o.position.z=p*f/2*5,o.position.y=50;for(var g=new THREE.TextureLoader,m=new THREE.BoxGeometry(5,5,5),w=[new THREE.MeshBasicMaterial({map:g.load("https://assets.codepen.io/3581324/side.jpg")}),new THREE.MeshBasicMaterial({map:g.load("https://assets.codepen.io/3581324/side.jpg")}),new THREE.MeshBasicMaterial({map:g.load("https://assets.codepen.io/3581324/top.jpg")}),new THREE.MeshBasicMaterial({map:g.load("https://assets.codepen.io/3581324/bottom.jpg")}),new THREE.MeshBasicMaterial({map:g.load("https://assets.codepen.io/3581324/side.jpg")}),new THREE.MeshBasicMaterial({map:g.load("https://assets.codepen.io/3581324/side.jpg")})],M=[new THREE.MeshBasicMaterial({map:g.load("https://assets.codepen.io/3581324/dirt.png")}),new THREE.MeshBasicMaterial({map:g.load("https://assets.codepen.io/3581324/dirt.png")}),new THREE.MeshBasicMaterial({map:g.load("https://assets.codepen.io/3581324/dirt.png")}),new THREE.MeshBasicMaterial({map:g.load("https://assets.codepen.io/3581324/dirt.png")}),new THREE.MeshBasicMaterial({map:g.load("https://assets.codepen.io/3581324/dirt.png")}),new THREE.MeshBasicMaterial({map:g.load("https://assets.codepen.io/3581324/dirt.png")})],E=[new THREE.MeshBasicMaterial({map:g.load("https://assets.codepen.io/3581324/cobblestone.png")}),new THREE.MeshBasicMaterial({map:g.load("https://assets.codepen.io/3581324/cobblestone.png")}),new THREE.MeshBasicMaterial({map:g.load("https://assets.codepen.io/3581324/cobblestone.png")}),new THREE.MeshBasicMaterial({map:g.load("https://assets.codepen.io/3581324/cobblestone.png")}),new THREE.MeshBasicMaterial({map:g.load("https://assets.codepen.io/3581324/cobblestone.png")}),new THREE.MeshBasicMaterial({map:g.load("https://assets.codepen.io/3581324/cobblestone.png")})],x=[{name:"grass",materialArray:w,mesh:new THREE.InstancedMesh(m,w,p*p*f*f*u),count:0,range:[0]},{name:"dirt",materialArray:M,mesh:new THREE.InstancedMesh(m,M,p*p*f*f*u),count:0,range:[1,2]},{name:"cobblestone",materialArray:E,mesh:new THREE.InstancedMesh(m,E,p*p*f*f*u),count:0,range:[3,4]}],b=["grass","dirt","cobblestone"],v=0;v<p;v++)for(j=0;j<p;j++){for(var z=[],k=v*f;k<v*f+f;k++)for(var T=j*f;T<j*f+f;T++){s=l*k,h=l*T;for(var H=5*Math.round(noise.perlin2(s,h)*d/5),R=0;R<u;R++){if(H-5*R<y)continue;let e=(new THREE.Matrix4).makeTranslation(5*k,H-5*R,5*T);for(var B=0;B<x.length;B++)x[B].range.includes(R)&&(x[B].mesh.setMatrixAt(x[B].count,e),x[B].count++,z.push(new r(5*k,H-5*R,5*T,!1,x[B].name)))}}i.push(z)}for(v=0;v<x.length;v++)n.add(x[v].mesh);var A=[],I=!0,P={forward:"w",backward:"s",right:"d",left:"a",jump:" ",placeBlock:"q"},L=[],S=[];for(k=0;k<p;k++)for(T=0;T<p;T++)S.push({x:k,z:T});function C(e,t){for(var n=e-Y(),a=t-$(),o=Math.floor(n/(5*f)),r=Math.floor(a/(5*f)),i=void 0,s=0;s<S.length;s++)if(S[s].x==o&&S[s].z==r){i=s;break}return i}var F=0,W=!1;document.addEventListener("keydown",function(e){if("w"==e.key){var t=(new Date).getTime();t-F<=300&&(W=!0),F=t}if(A.push(e.key),e.key==P.jump&&1==I&&(V=-1,I=!1),e.key==P.placeBlock){const e=new THREE.Raycaster,t=new THREE.Vector2;var a;t.x=0,t.y=0,e.setFromCamera(t,o);for(var s=!1,h=1/0,l=0;l<x.length;l++){var d=e.intersectObject(x[l].mesh);null!=d[0]&&d[0].distance<40&&d[0].distance<h&&(s=!0,a=d,h=d[0].distance)}if(s){console.log(a[0]);var c=a[0].face.materialIndex,g=a[0].point,w=0,M=0,E=0;const e=2.5;switch(c){case 0:w=g.x+e,M=5*Math.round(g.y/5),E=5*Math.round(g.z/5);break;case 1:w=g.x-e,M=5*Math.round(g.y/5),E=5*Math.round(g.z/5);break;case 2:w=5*Math.round(g.x/5),M=g.y+e,E=5*Math.round(g.z/5);break;case 3:w=5*Math.round(g.x/5),M=g.y-e,E=5*Math.round(g.z/5);break;case 4:w=5*Math.round(g.x/5),M=5*Math.round(g.y/5),E=g.z+e;break;case 5:w=5*Math.round(g.x/5),M=5*Math.round(g.y/5),E=g.z-e}if((M=Math.round(M))>y){var v=new r(w,M,E,!0,"cobblestone");if(!K(v.x,v.y,v.z,5,5,5,J.x,J.y,J.z,J.w,J.h,J.d)){i[C(w,E)].push(v),L.push(v);var z=b.indexOf("cobblestone");n.remove(x[z].mesh),x[z].mesh=new THREE.InstancedMesh(m,x[z].materialArray,p*p*f*f*u+L.length),x[z].count=0;for(l=0;l<i.length;l++)for(var k=0;k<i[l].length;k++){let e=(new THREE.Matrix4).makeTranslation(i[l][k].x,i[l][k].y,i[l][k].z);"cobblestone"==i[l][k].blockType&&(x[z].mesh.setMatrixAt(x[z].count,e),x[z].count++)}n.add(x[z].mesh)}}}}}),document.addEventListener("keyup",function(e){for(var t=[],n=0;n<A.length;n++)A[n]!=e.key&&t.push(A[n]);(A=t).includes("w")||(W=!1)});var O=new THREE.PointerLockControls(o,document.body),q=[];document.body.addEventListener("click",function(){if(O.lock(),O.isLocked){const z=new THREE.Raycaster,k=new THREE.Vector2;var e;k.x=0,k.y=0,z.setFromCamera(k,o);for(var t=1/0,a=0;a<x.length;a++){var s=z.intersectObject(x[a].mesh);null!=s[0]&&s[0].distance<40&&s[0].distance<t&&(!0,e=s,t=s[0].distance)}if(null!=e[0]&&e[0].distance<40){console.log(e[0].point);var h=e[0].face.materialIndex,l=e[0].point,d=0,c=0,y=0;const t=2.5;switch(h){case 0:d=l.x-t,c=5*Math.round(l.y/5),y=5*Math.round(l.z/5);break;case 1:d=l.x+t,c=5*Math.round(l.y/5),y=5*Math.round(l.z/5);break;case 2:d=5*Math.round(l.x/5),c=l.y-t,y=5*Math.round(l.z/5);break;case 3:d=5*Math.round(l.x/5),c=l.y+t,y=5*Math.round(l.z/5);break;case 4:d=5*Math.round(l.x/5),c=5*Math.round(l.y/5),y=l.z-t;break;case 5:d=5*Math.round(l.x/5),c=5*Math.round(l.y/5),y=l.z+t}var g=C(d,y),w=i[g];c=Math.round(c);var M=null;for(a=0;a<w.length;a++)if(w[a].x==d&&w[a].y==c&&w[a].z==y){if(w[a].placed){for(var E=0;E<L.length;E++)if(L[E].x==d&&L[E].y==c&&L[E].z==y){L.splice(E,1);break}}else q.push(new r(d,c,y,!1,w[a].blockType));M=w[a].blockType,i[g].splice(a,1);break}var v=b.indexOf(M);n.remove(x[v].mesh),x[v].mesh=new THREE.InstancedMesh(m,x[v].materialArray,p*p*f*f*u+L.length),x[v].count=0;for(a=0;a<i.length;a++)for(E=0;E<i[a].length;E++){let e=(new THREE.Matrix4).makeTranslation(i[a][E].x,i[a][E].y,i[a][E].z);i[a][E].blockType==M&&(x[v].mesh.setMatrixAt(x[v].count,e),x[v].count++)}n.add(x[v].mesh)}}}),O.addEventListener("lock",function(){}),O.addEventListener("unlock",function(){A=[]});var G=.5,V=0,D=.065,J={w:.6,h:8,d:.5,x:o.position.x,y:o.position.y,z:o.position.z,forward:function(e){O.moveForward(e),this.updatePosition()},backward:function(e){O.moveForward(-1*e),this.updatePosition()},right:function(e){O.moveRight(e),this.updatePosition()},left:function(e){O.moveRight(-1*e),this.updatePosition()},updatePosition:function(){this.x=o.position.x,this.y=o.position.y-this.h/2,this.z=o.position.z,this.y<=-50&&(this.y=25,o.position.y=25,this.x+=25,o.position.x+=25)}};function K(e,t,n,a,o,r,i,s,h,l,d,c){return e-a/2<=i+l/2&&e+a/2>=i-l/2&&t-o/2<=s+d/2&&t+o/2>=s-d/2&&n-r/2<=h+c/2&&n+r/2>=h-c/2}var N=1.35,Q=0,U=0,X=1.6;function Y(){for(var e=[],t=0;t<i.length;t++)for(var n=0;n<i[t].length;n++)e.push(i[t][n].x);return Math.min.apply(null,e)}function Z(){for(var e=[],t=0;t<i.length;t++)for(var n=0;n<i[t].length;n++)e.push(i[t][n].x);return Math.max.apply(null,e)}function $(){for(var e=[],t=0;t<i.length;t++)for(var n=0;n<i[t].length;n++)e.push(i[t][n].z);return Math.min.apply(null,e)}function _(){for(var e=[],t=0;t<i.length;t++)for(var n=0;n<i[t].length;n++)e.push(i[t][n].z);return Math.max.apply(null,e)}window.addEventListener("resize",function(){a.setSize(window.innerWidth,window.innerHeight),o.aspect=window.innerWidth/window.innerHeight,o.updateProjectionMatrix(),e.style.left=(.5*window.innerWidth-.5*e.width).toString()+"px",e.style.top=(.5*window.innerHeight-.5*e.height).toString()+"px"});const ee=new THREE.Raycaster,te=new THREE.Vector2;var ne;te.x=0,te.y=0,function e(){requestAnimationFrame(e),function(){if(J.updatePosition(),A.includes(P.forward)){J.forward(G*(W?X:1)),Q=1*G;for(var e=0;e<i.length;e++)for(var t=0;t<i[e].length;t++)K((B=i[e][t]).x,B.y,B.z,5,5,5,J.x,J.y,J.z,J.w,J.h,J.d)&&B.y-2.5<J.y+J.h/2&&B.y+2.5>J.y-J.h/2&&(J.backward(G*(W?X:1)),Q=0,U=0,W=!1)}if(A.includes(P.backward))for(J.backward(G*(W?X:1)),Q=-1*G,e=0;e<i.length;e++)for(t=0;t<i[e].length;t++)K((B=i[e][t]).x,B.y,B.z,5,5,5,J.x,J.y,J.z,J.w,J.h,J.d)&&B.y-2.5<J.y+J.h/2&&B.y+2.5>J.y-J.h/2&&(J.forward(G*(W?X:1)),Q=0,U=0,W=!1);if(A.includes(P.right))for(J.right(G*(W?X:1)),U=1*G,e=0;e<i.length;e++)for(t=0;t<i[e].length;t++)K((B=i[e][t]).x,B.y,B.z,5,5,5,J.x,J.y,J.z,J.w,J.h,J.d)&&B.y-2.5<J.y+J.h/2&&B.y+2.5>J.y-J.h/2&&(J.left(G*(W?X:1)),Q=0,U=0,W=!1);if(A.includes(P.left))for(J.left(G*(W?X:1)),U=-1*G,e=0;e<i.length;e++)for(t=0;t<i[e].length;t++)K((B=i[e][t]).x,B.y,B.z,5,5,5,J.x,J.y,J.z,J.w,J.h,J.d)&&B.y-2.5<J.y+J.h/2&&B.y+2.5>J.y-J.h/2&&(J.right(G*(W?X:1)),Q=0,U=0,W=!1);if(!(A.includes(P.forward)||A.includes(P.backward)||A.includes(P.right)||A.includes(P.left))){for(Q/=N,U/=N,e=0;e<i.length;e++){for(t=0;t<i[e].length;t++)if(K((B=i[e][t]).x,B.y,B.z,5,5,5,J.x,J.y,J.z,J.w,J.h,J.d)&&B.y-2.5<J.y+J.h/2&&B.y+2.5>J.y-J.h/2){var a=!0;Q/=-N,U/=-N,W=!1;break}if(a)break}J.forward(Q*(W?X:1)),J.right(U*(W?X:1))}for(o.position.y=o.position.y-V,V+=D,e=0;e<i.length;e++)for(t=0;t<i[e].length;t++)K((B=i[e][t]).x,B.y+10,B.z,5,5,5,J.x,J.y,J.z,J.w,J.h,J.d)&&o.position.y<=i[e][t].y+2.5+J.h&&o.position.y>=i[e][t].y&&(o.position.y=i[e][t].y+2.5+J.h,V=0,I=!0),K(B.x,B.y,B.z,5,5,5,J.x,J.y,J.z,J.w,J.h,J.d)&&o.position.y>=i[e][t].y-2.5&&o.position.y<=i[e][t].y&&(V=.5);var c=f*p*5;if(o.position.z<$()+.4*c){var g=[];for(e=0;e<i.length;e++)(e+1)%p!=0&&g.push(i[e]);var w=Y(),M=$();for(e=0;e<p;e++){for(var E=[],b=w+e*f*5;b<w+e*f*5+5*f;b+=5)for(var v=M-5*f;v<M;v+=5){s=l*b/5,h=l*v/5;for(var z=5*Math.round(noise.perlin2(s,h)*d/5),k=0;k<u;k++)if(!(z-5*k<y)){for(var T=!1,H=0;H<q.length;H++)if(q[H].x==b&&q[H].y==z-5*k&&q[H].z==v){T=!0;break}if(!T)for(var R=0;R<x.length;R++)if(x[R].range.includes(k)){E.push(new r(b,z-5*k,v,!1,x[R].name));break}}for(var B=0;B<L.length;B++)L[B].x==b&&L[B].z==v&&E.push(new r(L[B].x,L[B].y,L[B].z,!0,L[B].blockType))}g.splice(e*p,0,E)}for(i=g,e=0;e<x.length;e++)n.remove(x[e].mesh),x[e].mesh=new THREE.InstancedMesh(m,x[e].materialArray,p*p*f*f*u+L.length),x[e].count=0;for(e=0;e<i.length;e++)for(t=0;t<i[e].length;t++){let n=(new THREE.Matrix4).makeTranslation(i[e][t].x,i[e][t].y,i[e][t].z);for(R=0;R<x.length;R++)if(x[R].name==i[e][t].blockType){x[R].mesh.setMatrixAt(x[R].count,n),x[R].count++;break}}for(e=0;e<x.length;e++)n.add(x[e].mesh)}if(o.position.z>_()-.4*c){for(g=[],e=0;e<i.length;e++)e%p!=0&&g.push(i[e]);w=Y();var j=_();for(e=0;e<p;e++){for(E=[],b=w+e*f*5;b<w+e*f*5+5*f;b+=5)for(v=j+5;v<j+5+5*f;v+=5){for(s=l*b/5,h=l*v/5,z=5*Math.round(noise.perlin2(s,h)*d/5),k=0;k<u;k++)if(!(z-5*k<y)){for(T=!1,H=0;H<q.length;H++)if(q[H].x==b&&q[H].y==z-5*k&&q[H].z==v){T=!0;break}if(!T)for(R=0;R<x.length;R++)if(x[R].range.includes(k)){E.push(new r(b,z-5*k,v,!1,x[R].name));break}}for(B=0;B<L.length;B++)L[B].x==b&&L[B].z==v&&E.push(new r(L[B].x,L[B].y,L[B].z,!0,L[B].blockType))}g.splice((e+1)*p-1,0,E)}for(i=g,e=0;e<x.length;e++)n.remove(x[e].mesh),x[e].mesh=new THREE.InstancedMesh(m,x[e].materialArray,p*p*f*f*u+L.length),x[e].count=0;for(e=0;e<i.length;e++)for(t=0;t<i[e].length;t++){let n=(new THREE.Matrix4).makeTranslation(i[e][t].x,i[e][t].y,i[e][t].z);for(R=0;R<x.length;R++)if(x[R].name==i[e][t].blockType){x[R].mesh.setMatrixAt(x[R].count,n),x[R].count++;break}}for(e=0;e<x.length;e++)n.add(x[e].mesh)}if(o.position.x>Z()-.4*c){for(g=[],e=p;e<i.length;e++)g.push(i[e]);var S=Z();for(M=$(),e=0;e<p;e++){for(E=[],v=M+e*f*5;v<M+e*f*5+5*f;v+=5)for(b=S+5;b<S+5+5*f;b+=5){for(s=l*b/5,h=l*v/5,z=5*Math.round(noise.perlin2(s,h)*d/5),k=0;k<u;k++)if(!(z-5*k<y)){for(T=!1,H=0;H<q.length;H++)if(q[H].x==b&&q[H].y==z-5*k&&q[H].z==v){T=!0;break}if(!T)for(R=0;R<x.length;R++)if(x[R].range.includes(k)){E.push(new r(b,z-5*k,v,!1,x[R].name));break}}for(B=0;B<L.length;B++)L[B].x==b&&L[B].z==v&&E.push(new r(L[B].x,L[B].y,L[B].z,!0,L[B].blockType))}g.splice(i.length-(p-e),0,E)}for(i=g,e=0;e<x.length;e++)n.remove(x[e].mesh),x[e].mesh=new THREE.InstancedMesh(m,x[e].materialArray,p*p*f*f*u+L.length),x[e].count=0;for(e=0;e<i.length;e++)for(t=0;t<i[e].length;t++){let n=(new THREE.Matrix4).makeTranslation(i[e][t].x,i[e][t].y,i[e][t].z);for(R=0;R<x.length;R++)if(x[R].name==i[e][t].blockType){x[R].mesh.setMatrixAt(x[R].count,n),x[R].count++;break}}for(e=0;e<x.length;e++)n.add(x[e].mesh)}if(o.position.x<Y()+.4*c){for(g=[],e=0;e<i.length-p;e++)g.push(i[e]);for(w=Y(),M=$(),e=0;e<p;e++){for(E=[],v=M+e*f*5;v<M+e*f*5+5*f;v+=5)for(b=w-5*f;b<w;b+=5){for(s=l*b/5,h=l*v/5,z=5*Math.round(noise.perlin2(s,h)*d/5),k=0;k<u;k++)if(!(z-5*k<y)){for(T=!1,H=0;H<q.length;H++)if(q[H].x==b&&q[H].y==z-5*k&&q[H].z==v){T=!0;break}if(!T)for(R=0;R<x.length;R++)if(x[R].range.includes(k)){E.push(new r(b,z-5*k,v,!1,x[R].name));break}}for(B=0;B<L.length;B++)L[B].x==b&&L[B].z==v&&E.push(new r(L[B].x,L[B].y,L[B].z,!0,L[B].blockType))}g.splice(e,0,E)}for(i=g,e=0;e<x.length;e++)n.remove(x[e].mesh),x[e].mesh=new THREE.InstancedMesh(m,x[e].materialArray,p*p*f*f*u+L.length),x[e].count=0;for(e=0;e<i.length;e++)for(t=0;t<i[e].length;t++){let n=(new THREE.Matrix4).makeTranslation(i[e][t].x,i[e][t].y,i[e][t].z);for(R=0;R<x.length;R++)if(x[R].name==i[e][t].blockType){x[R].mesh.setMatrixAt(x[R].count,n),x[R].count++;break}}for(e=0;e<x.length;e++)n.add(x[e].mesh)}}(),function(){var e;ee.setFromCamera(te,o);for(var t=!1,r=1/0,i=0;i<x.length;i++){var s=ee.intersectObject(x[i].mesh);null!=s[0]&&s[0].distance<40&&s[0].distance<r&&(t=!0,e=s,r=s[0].distance)}if(t)if(n.children.includes(ne)){ne.visible=!0;var h=e[0].face.materialIndex,l=e[0].point,d=0,c=0,p=0;const t=.1;switch(h){case 0:ne.rotation.x=0,ne.rotation.y=Math.PI/2,ne.rotation.z=0,d=l.x+t,c=5*Math.round(l.y/5),p=5*Math.round(l.z/5);break;case 1:ne.rotation.x=0,ne.rotation.y=Math.PI/2,ne.rotation.z=0,d=l.x-t,c=5*Math.round(l.y/5),p=5*Math.round(l.z/5);break;case 2:ne.rotation.x=Math.PI/2,ne.rotation.y=0,ne.rotation.z=0,d=5*Math.round(l.x/5),c=l.y+t,p=5*Math.round(l.z/5);break;case 3:ne.rotation.x=Math.PI/2,ne.rotation.y=0,ne.rotation.z=0,d=5*Math.round(l.x/5),c=l.y-t,p=5*Math.round(l.z/5);break;case 4:ne.rotation.x=0,ne.rotation.y=0,ne.rotation.z=0,d=5*Math.round(l.x/5),c=5*Math.round(l.y/5),p=l.z+t;break;case 5:ne.rotation.x=0,ne.rotation.y=0,ne.rotation.z=0,d=5*Math.round(l.x/5),c=5*Math.round(l.y/5),p=l.z-t}ne.position.x=d,ne.position.y=c,ne.position.z=p}else{var f=new THREE.PlaneGeometry(5,5),u=new THREE.MeshBasicMaterial({color:16777215,side:THREE.DoubleSide});u.transparent=!0,u.opacity=.5,ne=new THREE.Mesh(f,u),n.add(ne)}else ne&&(ne.visible=!1);a.render(n,o)}()}()}();